(this["webpackJsonptrain-ticket"]=this["webpackJsonptrain-ticket"]||[]).push([[9],{13:function(e,t,a){},15:function(e,t,a){"use strict";var n=a(0),r=a.n(n),i=a(5),c=a.n(i),o=(a(19),a(20),Object(n.memo)((function(e){var t=e.date,a=e.prev,i=e.next,o=e.isPrevDisabled,l=e.isNextDisabled,s=Object(n.useMemo)((function(){var e=c()(t);return e.format("M \u6708 D \u65e5 ")+e.locale("zh-cn").format("ddd")}),[t]);return r.a.createElement("div",{className:"nav"},r.a.createElement("span",{onClick:function(){return a()},className:["nav-prev",o?"nav-disabled":""].filter(Boolean).join(" ")},"\u524d\u4e00\u5929"),r.a.createElement("span",{className:"nav-current"},s),r.a.createElement("span",{onClick:function(){return i()},className:["nav-next",l?"nav-disabled":""].filter(Boolean).join(" ")},"\u540e\u4e00\u5929"))})));t.a=o},16:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(0),r=a(2);function i(e,t,a){var i=Object(r.b)(e)<=Object(r.b)(),c=Object(r.b)(e)-Object(r.b)()>1728e6,o=Object(n.useCallback)((function(){i||t()}),[i,t]),l=Object(n.useCallback)((function(){c||a()}),[c,a]);return{isPrevDisabled:i,isNextDisabled:c,prev:o,next:l}}},17:function(e,t,a){"use strict";var n=a(0),r=a.n(n),i=a(5),c=a.n(i);a(19),a(22);function o(e){var t=c()(e);return t.format("MM-DD")+" "+t.locale("zh-cn").format("ddd")}var l=Object(n.memo)((function(e){var t=e.leaveDate,a=e.arriveDate,n=e.leaveTime,i=e.arriveTime,c=e.leaveStation,l=e.arriveStation,s=e.trainNumber,u=e.durationStr,d=o(t),m=o(a);return r.a.createElement("div",{className:"detail"},r.a.createElement("div",{className:"content"},r.a.createElement("div",{className:"left"},r.a.createElement("p",{className:"city"},c),r.a.createElement("p",{className:"time"},n),r.a.createElement("p",{className:"date"},d)),r.a.createElement("div",{className:"middle"},r.a.createElement("div",{className:"train-name"},s),r.a.createElement("p",{className:"train-mid"},e.children),r.a.createElement("p",{className:"train-time"},"\u8017\u65f6",u)),r.a.createElement("div",{className:"right"},r.a.createElement("p",{className:"city"},l),r.a.createElement("p",{className:"time"},i),r.a.createElement("p",{className:"date"},m))))}));t.a=l},2:function(e,t,a){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),t=new Date(e);return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.getTime()}function r(e,t){var a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:350;return function(){for(var r=arguments.length,i=new Array(r),c=0;c<r;c++)i[c]=arguments[c];var o=this;a&&(clearTimeout(a),t.apply(o,i)),a=setTimeout((function(){e.apply(o,i)}),n)}}a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return r}))},20:function(e,t,a){},22:function(e,t,a){},65:function(e,t,a){e.exports=a(72)},66:function(e,t,a){},67:function(e,t,a){},68:function(e,t,a){},7:function(e,t,a){"use strict";var n=a(0),r=a.n(n);a(13);t.a=function(e){var t=e.title,a=e.isBackVisible,n=void 0===a||a,i=e.handleBack;return r.a.createElement("div",{className:"header"},n?r.a.createElement("div",{className:"header-back",onClick:i},r.a.createElement("svg",{width:"42",height:"42"},r.a.createElement("polyline",{points:"25,13 16,21 25,29",stroke:"#fff",strokeWidth:"2",fill:"none"}))):null,r.a.createElement("h1",{className:"header-title"},t))}},72:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"setLeaveDate",(function(){return f})),a.d(n,"setArriveDate",(function(){return E})),a.d(n,"nextDate",(function(){return p})),a.d(n,"prevDate",(function(){return b})),a.d(n,"setLeaveTime",(function(){return S})),a.d(n,"setArriveTime",(function(){return h})),a.d(n,"setLeaveStation",(function(){return T})),a.d(n,"setArriveStation",(function(){return N})),a.d(n,"setTickets",(function(){return y})),a.d(n,"setTrainNumber",(function(){return O})),a.d(n,"setDurationStr",(function(){return D})),a.d(n,"setSearchParsed",(function(){return j})),a.d(n,"toggleScheduleVisible",(function(){return g}));var r=a(0),i=a.n(r),c=a(10),o=a.n(c),l=a(6),s=(a(18),a(9)),u=a(3),d={leaveDate:Date.now(),arriveDate:Date.now(),leaveTime:null,arriveTime:null,leaveStation:null,arriveStation:null,trainNumber:null,durationStr:null,tickets:[],isScheduleVisible:!1,isSearchParsed:!1},m=a(1),v=a(2);function f(e){return{type:"SET_LEAVE_DATE",payload:e}}function E(e){return{type:"SET_ARRIVE_DATE",payload:e}}function p(){return function(e,t){var a=t().leaveDate;e(f(Object(v.b)(a)+864e5))}}function b(){return function(e,t){var a=t().leaveDate;e(f(Object(v.b)(a)-864e5))}}function S(e){return{type:"SET_LEAVE_TIME",payload:e}}function h(e){return{type:"SET_ARRIVE_TIME",payload:e}}function T(e){return{type:"SET_LEAVE_STATION",payload:e}}function N(e){return{type:"SET_ARRIVE_STATION",payload:e}}function y(e){return{type:"SET_TICKETS",payload:e}}function O(e){return{type:"SET_TRAIN_NUMBER",payload:e}}function D(e){return{type:"SET_DURATION_STR",payload:e}}function j(){return{type:"SET_SEARCH_PARSED",payload:!0}}function g(){return function(e,t){e({type:"TOGGLE_SCHEDULE_VISIBLE",payload:!t().isScheduleVisible})}}var _=[function(e,t){var a=t.type,n=t.payload;switch(a){case"SET_LEAVE_DATE":return Object(m.a)({},e,{leaveDate:n});case"SET_ARRIVE_DATE":return Object(m.a)({},e,{arriveDate:n});default:return e}},function(e,t){var a=t.type,n=t.payload;switch(a){case"SET_LEAVE_TIME":return Object(m.a)({},e,{leaveTime:n});case"SET_ARRIVE_TIME":return Object(m.a)({},e,{arriveTime:n});default:return e}},function(e,t){var a=t.type,n=t.payload;switch(a){case"SET_LEAVE_STATION":return Object(m.a)({},e,{leaveStation:n});case"SET_ARRIVE_STATION":return Object(m.a)({},e,{arriveStation:n});default:return e}},function(e,t){var a=t.type,n=t.payload;switch(a){case"SET_TICKETS":return Object(m.a)({},e,{tickets:n});default:return e}},function(e,t){var a=t.type,n=t.payload;switch(a){case"SET_TRAIN_NUMBER":return Object(m.a)({},e,{trainNumber:n});default:return e}},function(e,t){var a=t.type,n=t.payload;switch(a){case"SET_DURATION_STR":return Object(m.a)({},e,{durationStr:n});default:return e}},function(e,t){var a=t.type,n=t.payload;switch(a){case"SET_SEARCH_PARSED":return Object(m.a)({},e,{isSearchParsed:n});default:return e}},function(e,t){var a=t.type,n=t.payload;switch(a){case"TOGGLE_SCHEDULE_VISIBLE":return Object(m.a)({},e,{isScheduleVisible:n});default:return e}}];var w=a(12),k=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.c,A=Object(u.d)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;return _.reduce((function(e,a){return a(e,t)}),e)}),k(Object(u.a)(w.a))),R=(a(66),a(8)),I=a.n(R),V=a(5),C=a.n(V),L=(a(67),a(7)),x=a(15),M=a(17),P=a(4),B=(a(68),Object(r.createContext)()),U=Object(r.memo)((function(e){var t=e.name,a=e.desc,n=e.type,c=Object(r.useContext)(B),o=c.trainNumber,l=c.leaveStation,s=c.arriveStation,u=c.leaveDate,d=Object(r.useMemo)((function(){return new I.a("order.html").setSearch("trainNumber",o).setSearch("leaveStation",l).setSearch("arriveStation",s).setSearch("type",n).setSearch("date",C()(u).format("YYYY-MM-DD")).toString()}),[n,o,l,s,u]);return i.a.createElement("div",{className:"channel"},i.a.createElement("div",{className:"middle"},i.a.createElement("div",{className:"name"},t),i.a.createElement("div",{className:"desc"},a)),i.a.createElement("a",{href:d,className:"buy-wrapper"},i.a.createElement("div",{className:"buy"},"\u4e70\u7968")))})),W=Object(r.memo)((function(e){var t=e.type,a=e.priceMsg,n=e.ticketsLeft,r=e.channels,c=e.expanded,o=e.toggle,l=e.index;return i.a.createElement("li",null,i.a.createElement("div",{className:"bar",onClick:function(){return o(l)}},i.a.createElement("span",{className:"seat"},t),i.a.createElement("span",{className:"price"},i.a.createElement("i",null,"$"),a),i.a.createElement("span",{className:"btn"},c?"\u6536\u8d77":"\u9884\u5b9a"),i.a.createElement("span",{className:"num"},n)),i.a.createElement("div",{className:"channels",style:{height:c?55*r.length+"px":0}},r.map((function(e){return i.a.createElement(U,Object.assign({key:e.name},e,{type:t}))}))))})),Y=Object(r.memo)((function(e){var t=e.tickets,a=Object(r.useState)(-1),n=Object(P.a)(a,2),c=n[0],o=n[1],l=Object(r.useCallback)((function(e){o(e===c?-1:e)}),[c]);return i.a.createElement("div",{className:"candidate"},i.a.createElement("ul",null,t.map((function(e,t){return i.a.createElement(W,Object.assign({key:e.type},e,{expanded:c===t,toggle:l,index:t}))}))))})),H=a(16),G=Object(r.lazy)((function(){return a.e(10).then(a.bind(null,74))}));var z=Object(l.b)((function(e){return Object(m.a)({},e)}),(function(e){return{dispatch:e}}))((function(e){var t=e.leaveDate,a=e.arriveDate,c=e.leaveTime,o=e.arriveTime,l=e.leaveStation,s=e.arriveStation,d=e.trainNumber,m=e.durationStr,f=e.tickets,E=e.isScheduleVisible,p=e.isSearchParsed,b=e.dispatch,S=Object(r.useMemo)((function(){return Object(u.b)(n,b)}),[b]);Object(r.useEffect)((function(){var e=I.a.parseQuery(window.location.search),t=e.aStation,a=e.dStation,n=e.trainNumber,r=e.date,i=S.setLeaveDate,c=S.setLeaveStation,o=S.setArriveStation,l=S.setTrainNumber,s=S.setSearchParsed;i(Object(v.b)(C()(r).valueOf())),c(a),o(t),l(n),s(!0)}),[S]),Object(r.useEffect)((function(){document.title=d}),[d]),Object(r.useEffect)((function(){if(p){var e=new I.a("/rest/ticket").setSearch("date",C()(t).format("YYYY-MM-DD")).setSearch("trainNumber",d).toString();fetch(e).then((function(e){return e.json()})).then((function(e){var t=e.detail,a=e.candidates,n=t.departTimeStr,r=t.arriveTimeStr,i=t.arriveDate,c=t.durationStr,o=S.setLeaveTime,l=S.setArriveTime,s=S.setArriveDate,u=S.setDurationStr,d=S.setTickets;o(n),l(r),s(i),u(c),d(a)}))}}),[p,t,d,S]);var h=Object(r.useCallback)((function(){window.history.back()}),[]),T=Object(H.a)(t,S.prevDate,S.nextDate),N=T.isPrevDisabled,y=T.isNextDisabled,O=T.prev,D=T.next;return p?i.a.createElement("div",{className:"app"},i.a.createElement("div",{className:"header-wrapper"},i.a.createElement(L.a,{title:d,handleBack:h,isBackVisible:!0})),i.a.createElement(x.a,{date:t,isPrevDisabled:N,isNextDisabled:y,prev:O,next:D}),i.a.createElement(M.a,{leaveDate:t,arriveDate:a,leaveTime:c,arriveTime:o,leaveStation:l,arriveStation:s,trainNumber:d,durationStr:m},i.a.createElement("span",{className:"left"}),i.a.createElement("span",{className:"schedule",onClick:function(){return S.toggleScheduleVisible()}},"\u65f6\u523b\u8868"),i.a.createElement("span",{className:"right"})),i.a.createElement(B.Provider,{value:{trainNumber:d,leaveDate:t,leaveStation:l,arriveStation:s}},i.a.createElement(Y,{tickets:f})),E&&i.a.createElement("div",{className:"mask",onClick:function(){return S.toggleScheduleVisible()}},i.a.createElement(r.Suspense,{fallback:i.a.createElement("div",null,"loading")},i.a.createElement(G,{date:t,trainNumber:d,leaveStation:l,arriveStation:s})))):null}));o.a.render(i.a.createElement(l.a,{store:A},i.a.createElement(z,null)),document.getElementById("root")),s.a()},9:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function r(e){if("serviceWorker"in navigator){if(new URL("/train-ticket",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/train-ticket","/service-worker.js");n?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):i(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):i(t,e)}))}}function i(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}}},[[65,8,0,1]]]);
//# sourceMappingURL=ticket.d294006a.chunk.js.map