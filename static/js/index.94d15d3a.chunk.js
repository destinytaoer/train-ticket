(this["webpackJsonptrain-ticket"]=this["webpackJsonptrain-ticket"]||[]).push([[2],{13:function(e,t,n){},2:function(e,t,n){"use strict";function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now(),t=new Date(e);return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t.getTime()}function c(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:350;return function(){for(var c=arguments.length,r=new Array(c),i=0;i<c;i++)r[i]=arguments[i];var l=this;n&&(clearTimeout(n),t.apply(l,r)),n=setTimeout((function(){e.apply(l,r)}),a)}}n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return c}))},32:function(e,t,n){e.exports=n.p+"static/media/switch.b672b5fb.svg"},33:function(e,t,n){e.exports=n(71)},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){},7:function(e,t,n){"use strict";var a=n(0),c=n.n(a);n(13);t.a=function(e){var t=e.title,n=e.isBackVisible,a=void 0===n||n,r=e.handleBack;return c.a.createElement("div",{className:"header"},a?c.a.createElement("div",{className:"header-back",onClick:r},c.a.createElement("svg",{width:"42",height:"42"},c.a.createElement("polyline",{points:"25,13 16,21 25,29",stroke:"#fff",strokeWidth:"2",fill:"none"}))):null,c.a.createElement("h1",{className:"header-title"},t))}},71:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"setSelectedCity",(function(){return w})),n.d(a,"exchangeFromTo",(function(){return k})),n.d(a,"setCityData",(function(){return h})),n.d(a,"fetchCityData",(function(){return E})),n.d(a,"setCityDataLoading",(function(){return f})),n.d(a,"showCitySelector",(function(){return y})),n.d(a,"hideCitySelector",(function(){return p})),n.d(a,"setDate",(function(){return C})),n.d(a,"showDateSelector",(function(){return v})),n.d(a,"hideDateSelector",(function(){return g})),n.d(a,"toggleHighSpeed",(function(){return O}));var c=n(0),r=n.n(c),i=n(10),l=n.n(i),o=n(6),s=(n(18),n(9)),u=n(3),d={from:"\u5317\u4eac",to:"\u4e0a\u6d77",cityData:null,isCitySelectorVisible:!1,isLeftCity:!1,isCityDataLoading:!1,date:Date.now(),isDateSelectorVisible:!1,isHighSpeed:!1},m=n(1);function f(e){return{type:"SET_CITY_DATA_LOADING",payload:e}}function h(e){return{type:"SET_CITY_DATA",payload:e}}function E(){return function(e,t){if(!t().isCityDataLoading){e(f(!0));var n=JSON.parse(localStorage.getItem("city_data_cache")||"{}");Date.now()<n.expires&&e(h(n.data)),fetch("/rest/cities?_"+Date.now()).then((function(e){return e.json()})).then((function(t){e(h(t)),localStorage.setItem("city_data_cache",JSON.stringify({expires:Date.now()+9e5,data:t})),e(f(!1))})).catch((function(){e(f(!1))}))}}}function y(e){return function(t){t({type:"SET_CITY_SELECTOR_VISIBLE",payload:!0}),t({type:"SET_IS_LEFT_CITY",payload:e})}}function p(){return{type:"SET_CITY_SELECTOR_VISIBLE",payload:!1}}function v(){return{type:"SET_DATE_SELECTOR_VISIBLE",payload:!0}}function g(){return{type:"SET_DATE_SELECTOR_VISIBLE",payload:!1}}function S(e){return{type:"SET_FROM",payload:e}}function b(e){return{type:"SET_TO",payload:e}}function w(e){return function(t,n){t(n().isLeftCity?S(e):b(e)),t({type:"SET_CITY_SELECTOR_VISIBLE",payload:!1})}}function k(){return function(e,t){var n=t(),a=n.from;e(S(n.to)),e(b(a))}}function O(e){return function(e,t){e({type:"TOGGLE_HIGH_SPEED",payload:!t().isHighSpeed})}}function C(e){return{type:"SET_DATE",payload:e}}var T=[function(e,t){var n=t.type,a=t.payload;switch(n){case"SET_CITY_DATA":return Object(m.a)({},e,{cityData:a});default:return e}},function(e,t){var n=t.type,a=t.payload;switch(n){case"SET_CITY_DATA_LOADING":return Object(m.a)({},e,{isCityDataLoading:a});default:return e}},function(e,t){var n=t.type,a=t.payload;switch(n){case"SET_CITY_SELECTOR_VISIBLE":return Object(m.a)({},e,{isCitySelectorVisible:a});case"SET_IS_LEFT_CITY":return Object(m.a)({},e,{isLeftCity:a});default:return e}},function(e,t){var n=t.type,a=t.payload;switch(n){case"SET_DATE_SELECTOR_VISIBLE":return Object(m.a)({},e,{isDateSelectorVisible:a});default:return e}},function(e,t){var n=t.type,a=t.payload;switch(n){case"SET_DATE":return Object(m.a)({},e,{date:a});default:return e}},function(e,t){var n=t.type,a=t.payload;switch(n){case"SET_FROM":return Object(m.a)({},e,{from:a});case"SET_TO":return Object(m.a)({},e,{to:a});default:return e}},function(e,t){var n=t.type,a=t.payload;switch(n){case"TOGGLE_HIGH_SPEED":return Object(m.a)({},e,{isHighSpeed:a});default:return e}}];var j=n(12),D=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||u.c,_=Object(u.d)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;return T.reduce((function(e,n){return n(e,t)}),e)}),D(Object(u.a)(j.a))),N=(n(42),n(43),n(7)),I=n(32),L=n.n(I);n(44);var M=function(e){var t=e.from,n=e.to,a=e.exchangeFromTo,c=e.showCitySelector;return r.a.createElement("div",{className:"journey"},r.a.createElement("div",{className:"journey-station",onClick:function(){return c(!0)}},r.a.createElement("input",{type:"text",readOnly:!0,name:"from",className:"journey-input journey-from",value:t})),r.a.createElement("div",{className:"journey-switch",onClick:a},r.a.createElement("img",{src:L.a,width:"70",height:"40",alt:"switch"})),r.a.createElement("div",{className:"journey-station",onClick:function(){return c(!1)}},r.a.createElement("input",{type:"text",readOnly:!0,name:"to",className:"journey-input journey-to",value:n})))},A=n(5),B=n.n(A),V=n(2);n(45);var Y=function(e){var t=e.time,n=e.handleClick,a=Object(V.b)(t),i=Object(c.useMemo)((function(){return new Date(a)}),[a]),l=Object(c.useMemo)((function(){return a===Object(V.b)()}),[a]),o=Object(c.useMemo)((function(){return B()(a).format("YYYY-MM-DD")}),[a]),s=Object(c.useMemo)((function(){return"\u661f\u671f"+["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"][i.getDay()]+(l?" (\u4eca\u5929)":"")}),[i,l]);return r.a.createElement("div",{className:"depart-date",onClick:n},r.a.createElement("input",{type:"hidden",name:"date",value:o}),r.a.createElement("span",null,o),r.a.createElement("span",{className:"depart-week"},s))};n(46);var x=function(e){var t=e.isHighSpeed,n=e.toggle;return r.a.createElement("div",{className:"high-speed"},r.a.createElement("div",{className:"high-speed-label"},"\u53ea\u770b\u9ad8\u94c1/\u52a8\u8f66"),r.a.createElement("div",{className:"high-speed-switch",onClick:function(){return n()}},r.a.createElement("input",{type:"hidden",name:"highSpeed",value:t}),r.a.createElement("div",{className:["high-speed-track",t?"checked":""].filter(Boolean).join(" ")},r.a.createElement("span",{className:["high-speed-handle",t?"checked":""].filter(Boolean).join(" ")}))))},H=(n(47),Object(c.memo)((function(){return r.a.createElement("div",{className:"submit"},r.a.createElement("button",{type:"submit",className:"submit-button"},"\u641c\u7d22"))}))),R=n(4),W=(n(48),Object(c.memo)((function(e){var t=e.name,n=e.handleSelect;return r.a.createElement("li",{className:"city-li",onClick:function(){return n(t)}},t)}))),F=Object(c.memo)((function(e){var t=e.title,n=e.cities,a=void 0===n?[]:n,c=e.handleSelect;return r.a.createElement("ul",{className:"city-ul"},r.a.createElement("li",{className:"city-li",key:t,"data-cate":t},t),a.map((function(e){return r.a.createElement(W,{key:e.name,name:e.name,handleSelect:c})})))})),G=Object(c.memo)((function(e){var t=e.alpha,n=e.handleClick;return r.a.createElement("i",{className:"city-index-item",onClick:function(){return n(t)}},t)})),P=Object(c.memo)((function(e){var t=e.sections,n=e.handleSelect,a=e.toAlpha,i=Object(c.useMemo)((function(){return Array.from(new Array(26),(function(e,t){return String.fromCharCode(65+t)}))}),[]);return r.a.createElement("div",{className:"city-list"},r.a.createElement("div",{className:"city-cate"},t.map((function(e){return r.a.createElement(F,{key:e.title,title:e.title,cities:e.citys,handleSelect:n})}))),r.a.createElement("div",{className:"city-index"},i.map((function(e){return r.a.createElement(G,{key:e,alpha:e,handleClick:a})}))))})),U=Object(c.memo)((function(e){var t=e.name,n=e.handleClick;return r.a.createElement("li",{className:"city-suggest-li",onClick:function(){return n}},t)})),J=Object(c.memo)((function(e){var t=e.searchKey,n=e.handleSelect,a=Object(c.useState)([]),i=Object(R.a)(a,2),l=i[0],o=i[1];Object(c.useEffect)((function(){fetch("/rest/search?key="+encodeURIComponent(t)).then((function(e){return e.json()})).then((function(e){var n=e.result;e.searchKey===t&&o(n)}))}),[t]);var s=Object(c.useMemo)((function(){return l.length?l:[{display:t}]}),[l,t]);return r.a.createElement("div",{className:"city-suggest"},r.a.createElement("ul",{className:"city-suggest-ul"},s.map((function(e){return r.a.createElement(U,{key:e.display,name:e.display,handleClick:n})}))))})),K=Object(c.memo)((function(e){var t=e.show,n=e.cityData,a=e.isLoading,i=e.handleBack,l=e.fetchCityData,o=e.handleSelect,s=Object(c.useState)(""),u=Object(R.a)(s,2),d=u[0],m=u[1],f=Object(c.useMemo)((function(){return d.trim()}),[d]);Object(c.useEffect)((function(){t&&!n&&l()}),[t,n,l]);var h=Object(c.useCallback)((function(e){document.querySelector("[data-cate='".concat(e,"']")).scrollIntoView()}),[]),E=Object(c.useCallback)((function(){return a?r.a.createElement("div",null,"loading"):n?r.a.createElement(P,{sections:n.cityList,handleSelect:o,toAlpha:h}):r.a.createElement("div",null,"error")}),[a,n,o,h]);return r.a.createElement("div",{className:["city-selector",!t&&"hidden"].filter(Boolean).join(" ")},r.a.createElement("div",{className:"city-search"},r.a.createElement("div",{className:"search-back",onClick:function(){return i()}},r.a.createElement("svg",{width:"42",height:"42"},r.a.createElement("polyline",{points:"25,13 16,21 25,29",stroke:"#fff",strokeWidth:"2",fill:"none"}))),r.a.createElement("div",{className:"search-input-wrapper"},r.a.createElement("input",{type:"text",value:d,className:"search-input",placeholder:"\u57ce\u5e02/\u8f66\u7ad9\u7684\u4e2d\u6587\u6216\u62fc\u97f3",onChange:function(e){return m(e.target.value)}})),r.a.createElement("i",{className:["search-clean",0===f.length&&"hidden"].filter(Boolean).join(" "),onClick:function(){return m("")}},"\uf063")),Boolean(f)&&r.a.createElement(J,{searchKey:f,handleSelect:o}),E())}));n(49);function q(e){var t=e.day,n=e.handleSelect,a=Object(c.useMemo)((function(){return Object(V.b)()===t?"\u4eca\u5929":new Date(t).getDate()}),[t]);if(!t)return r.a.createElement("td",{className:"null"});var i=Object(V.b)(),l=[6,0].includes(new Date(t).getDay());return t<i?r.a.createElement("td",{className:["disabled",l?"weekend":""].filter(Boolean).join(" ")},a):r.a.createElement("td",{onClick:function(){return n(t)},className:l?"weekend":""},a)}function X(e){var t=e.days,n=e.handleSelect;return r.a.createElement("tr",{className:"date-table-days"},t.map((function(e,t){return r.a.createElement(q,{key:t,day:e,handleSelect:n})})))}function $(e){var t=e.startingTimeInMonth,n=e.handleSelect,a=new Date(t),i=Object(c.useMemo)((function(){for(var e=new Date(t),n=new Date(t),a=[];n.getMonth()===e.getMonth();)a.push(n.getTime()),n.setDate(n.getDate()+1);a=new Array(e.getDay()).fill(null).concat(a);var c=new Date(a[a.length-1]);a=a.concat(new Array(6-c.getDay()).fill(null));for(var r=[],i=0;i<a.length/7;i++){var l=a.slice(7*i,7*(i+1));r.push(l)}return r}),[t]);return r.a.createElement("table",{className:"date-table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("td",{colSpan:"7"},r.a.createElement("h5",null,"".concat(a.getFullYear(),"\u5e74").concat(a.getMonth()+1,"\u6708"))))),r.a.createElement("tbody",null,r.a.createElement("tr",{className:"date-table-weeks"},r.a.createElement("th",{className:"weekend"},"\u5468\u65e5"),r.a.createElement("th",null,"\u5468\u4e00"),r.a.createElement("th",null,"\u5468\u4e8c"),r.a.createElement("th",null,"\u5468\u4e09"),r.a.createElement("th",null,"\u5468\u56db"),r.a.createElement("th",null,"\u5468\u4e94"),r.a.createElement("th",{className:"weekend"},"\u5468\u516d")),i.map((function(e,t){return r.a.createElement(X,{key:t,days:e,handleSelect:n})}))))}var z=function(e){var t=e.show,n=e.handleSelect,a=e.handleBack,i=Object(c.useMemo)((function(){var e=new Date;e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.setDate(1);var t=[];return t.push(e.getTime()),e.setMonth(e.getMonth()+1),t.push(e.getTime()),e.setMonth(e.getMonth()+1),t.push(e.getTime()),t}),[]);return r.a.createElement("div",{className:["date-selector",t?"":"hidden"].filter(Boolean).join(" ")},r.a.createElement(N.a,{title:"\u65e5\u671f\u9009\u62e9",handleBack:a,isBackVisible:!0}),r.a.createElement("div",{className:"date-selector-tables"},i.map((function(e){return r.a.createElement($,{key:e,startingTimeInMonth:e,handleSelect:n})}))))};var Q=Object(o.b)((function(e){return Object(m.a)({},e)}),(function(e){return{dispatch:e}}))((function(e){var t=e.from,n=e.to,i=e.isCitySelectorVisible,l=e.isDateSelectorVisible,o=e.cityData,s=e.isCityDataLoading,d=e.date,m=e.isHighSpeed,f=e.dispatch,h=Object(c.useMemo)((function(){return Object(u.b)(a,f)}),[f]),E=Object(c.useCallback)((function(){window.history.back()}),[]),y=Object(c.useCallback)((function(e){h.setDate(e),h.hideDateSelector()}),[h]);return r.a.createElement("div",null,r.a.createElement("div",{className:"header-wrapper"},r.a.createElement(N.a,{title:"\u706b\u8f66\u7968",isBackVisible:!1,handleBack:E})),r.a.createElement("form",{action:"./query.html",className:"form"},r.a.createElement(M,{from:t,to:n,exchangeFromTo:h.exchangeFromTo,showCitySelector:h.showCitySelector}),r.a.createElement(Y,{time:d,handleClick:h.showDateSelector}),r.a.createElement(x,{isHighSpeed:m,toggle:h.toggleHighSpeed}),r.a.createElement(H,null)),r.a.createElement(K,{show:i,cityData:o,isLoading:s,handleBack:h.hideCitySelector,fetchCityData:h.fetchCityData,handleSelect:h.setSelectedCity}),r.a.createElement(z,{show:l,handleBack:h.hideDateSelector,handleSelect:y}))}));l.a.render(r.a.createElement(o.a,{store:_},r.a.createElement(Q,null)),document.getElementById("root")),s.a()},9:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function c(e){if("serviceWorker"in navigator){if(new URL("/train-ticket",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/train-ticket","/service-worker.js");a?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):r(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):r(t,e)}))}}function r(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}}},[[33,5,0]]]);
//# sourceMappingURL=index.94d15d3a.chunk.js.map